plugins {
    id "com.moowork.node" version "1.2.0"
}

def currentDir = project.projectDir
subprojects {
    apply plugin: 'com.moowork.node'

    node {
        version = '8.9.4'
        npmVersion = '5.6.0'
        download = true

        workDir = file("${currentDir}/.gradle/nodejs")
        npmWorkDir = file("${currentDir}/.gradle/npm")
    }

    tasks.npm_install.configure {
        inputs.files('package.json', 'package-lock.json')
        outputs.dirs('node_modules')
    }

    task build(type: NpmTask, dependsOn: npm_install) {
        args = ['run', 'build']
        inputs.files('package.json', 'package-lock.json')
        inputs.dir('src')
    }

    task clean {
        delete project.buildDir, 'dist'
    }

}