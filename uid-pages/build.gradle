plugins {
    id 'com.moowork.node'
}

def runTest = task runTest {

}

def parentProject = project

subprojects { subProject ->

    apply plugin: 'com.moowork.node'
    task unzip(type: Copy) {
        dependsOn('buildUIDPage')
        println "task unzip ${project.name}"
        def zipFile = file("${buildDir}/${project.name}-${project.version}.zip")
        def outputDir = file("${buildDir}/dist")

        from zipTree(zipFile)
        into outputDir
    }

    parentProject.task([dependsOn: unzip, type: NpmTask],"openTest-"+subProject.name) {
        args = ['run', 'open', '--', '--project', subProject.name]
    }

    def subProjectRunTest = parentProject.task([dependsOn: unzip, type: NpmTask],"runTest-"+subProject.name) {
        args = ['test', '--', '--project', subProject.name]
    }
    runTest.dependsOn subProjectRunTest
}